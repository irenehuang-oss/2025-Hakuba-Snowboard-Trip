<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 東京白馬滑雪行</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Noto Sans TC', 'sans-serif'] },
                    colors: {
                        ice: '#f0f9ff',
                        primary: '#0ea5e9',
                        dark: '#0f172a',
                    }
                }
            }
        }
    </script>
    <style>
        /* 隱藏捲軸但保持功能 */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .tab-active {
            background-color: #0ea5e9;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.4);
            transform: scale(1.05);
        }
        /* 淡入動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans pb-24">

    <header class="relative h-[25vh] min-h-[200px] flex flex-col items-center justify-center text-white overflow-hidden bg-slate-900">
        <img src="https://images.unsplash.com/photo-1551524559-8af4e6624178?q=80&w=2626&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-60" alt="Background">
        <div class="relative z-10 text-center px-4 mt-4">
            <h1 class="text-2xl md:text-4xl font-bold drop-shadow-lg">2026 東京白馬滑雪</h1>
            <div id="countdown" class="mt-2 text-sm md:text-base font-mono bg-black/30 px-3 py-1 rounded-full inline-block backdrop-blur-sm">
                Loading...
            </div>
        </div>
    </header>

    <section class="relative -mt-8 mb-6 z-20 px-4">
        <div class="bg-white rounded-xl shadow-lg p-4 overflow-hidden">
            <h3 class="text-xs font-bold text-gray-400 uppercase mb-3 flex items-center justify-between">
                <span><i class="fas fa-cloud-sun mr-2"></i> 當地預報 (14天內)</span>
                <span id="weather-status" class="text-[10px] text-blue-500">更新中...</span>
            </h3>
            <div class="flex overflow-x-auto gap-3 pb-2 hide-scrollbar snap-x" id="weather-container">
                <div class="text-center w-full py-4 text-gray-400 text-sm">載入行程與天氣中...</div>
            </div>
        </div>
    </section>

    <nav class="sticky top-0 z-40 bg-slate-100/95 backdrop-blur-md border-b border-slate-200 shadow-sm py-3 transition-all">
        <div class="px-4">
            <div class="flex overflow-x-auto gap-3 hide-scrollbar snap-x py-1" id="date-tabs">
                </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-6 max-w-2xl min-h-[50vh]" id="itinerary-content">
        </main>

    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 flex justify-around py-3 z-50 text-xs text-gray-500 safe-area-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
        <a href="#" onclick="showResortInfo(); return false;" class="flex flex-col items-center hover:text-primary transition-colors">
            <i class="fas fa-snowflake text-lg mb-1"></i>
            <span>雪場資訊</span>
        </a>
        <a href="#" onclick="window.scrollTo({top:0, behavior:'smooth'})" class="flex flex-col items-center hover:text-primary text-primary transition-colors">
            <i class="fas fa-calendar-alt text-lg mb-1"></i>
            <span>每日行程</span>
        </a>
        <a href="https://www.google.com/maps" target="_blank" class="flex flex-col items-center hover:text-primary transition-colors">
            <i class="fas fa-map-marked-alt text-lg mb-1"></i>
            <span>導航</span>
        </a>
    </div>

    <div id="resort-modal" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-4 animate-fade-in">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-y-auto p-6 relative shadow-2xl">
            <button onclick="document.getElementById('resort-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="text-xl font-bold mb-6 flex items-center"><i class="fas fa-skiing mr-2 text-primary"></i> 雪場快速比較</h2>
            <div class="space-y-4">
                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                    <div class="flex justify-between items-center mb-1">
                        <h3 class="font-bold text-green-800">Sanosaka (佐野坂)</h3>
                        <span class="text-xs bg-white px-2 py-0.5 rounded border border-green-200">初階/放鬆</span>
                    </div>
                    <p class="text-sm text-gray-600">人少、面湖景、適合練習。</p>
                </div>
                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                    <div class="flex justify-between items-center mb-1">
                        <h3 class="font-bold text-green-800">Tsugaike (栂池)</h3>
                        <span class="text-xs bg-white px-2 py-0.5 rounded border border-green-200">新手天堂</span>
                    </div>
                    <p class="text-sm text-gray-600">超寬綠道、無夜滑。</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <div class="flex justify-between items-center mb-1">
                        <h3 class="font-bold text-blue-800">Goryu (五龍)</h3>
                        <span class="text-xs bg-white px-2 py-0.5 rounded border border-blue-200">基地/夜滑</span>
                    </div>
                    <p class="text-sm text-gray-600">有夜滑、地形豐富、連接47。</p>
                </div>
                <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                    <div class="flex justify-between items-center mb-1">
                        <h3 class="font-bold text-red-800">Happo-One (八方)</h3>
                        <span class="text-xs bg-white px-2 py-0.5 rounded border border-red-200">高手/奧運</span>
                    </div>
                    <p class="text-sm text-gray-600">景色壯觀、難度高、高手向。</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 設定：你的行程日期與地點 ---
        const locationMap = {
            "12/21": "Tokyo", "12/22": "Tokyo", "12/23": "Tokyo", "12/24": "Tokyo",
            "12/25": "Hakuba", "12/26": "Hakuba", "12/27": "Hakuba", "12/28": "Hakuba", 
            "12/29": "Hakuba", "12/30": "Hakuba", "12/31": "Hakuba", "1/1": "Hakuba", 
            "1/2": "Hakuba", "1/3": "Tokyo", "1/4": "Tokyo"
        };

        const coords = {
            Tokyo: { lat: 35.6895, long: 139.6917 },
            Hakuba: { lat: 36.6982, long: 137.8619 }
        };

        // --- DATA: 行程資料庫 ---
        let tripData = [
            {
                date: "12/21", day: "週日", location: "東京", 
                weather: { icon: "fa-plane", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "16:50", title: "抵達東京成田", icon: "fa-plane-arrival", desc: "領行李、買西瓜卡" },
                    { time: "20:30", title: "入住 remm Akihabara", icon: "fa-bed", desc: "秋葉原" }
                ]
            },
            {
                date: "12/22", day: "週一", location: "東京",
                weather: { icon: "fa-sun", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "10:00", title: "御茶水買雪具", icon: "fa-shopping-bag", desc: "逛 Victoria, London Sports" },
                    { time: "12:30", title: "午餐：海老丸拉麵", icon: "fa-utensils", desc: "龍蝦湯頭拉麵", link: "https://goo.gl/maps/placeholder" }
                ]
            },
            {
                date: "12/23", day: "週二", location: "東京",
                weather: { icon: "fa-cloud", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "All Day", title: "自由活動", icon: "fa-user-clock", desc: "建議：澀谷 Sky 或 明治神宮" } ]
            },
            {
                date: "12/24", day: "週三", location: "東京",
                weather: { icon: "fa-star", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "09:00", title: "哈利波特影城", icon: "fa-magic", desc: "豐島園站西南" },
                    { time: "18:00", title: "成員會合", icon: "fa-users", desc: "Ashley/Elliott, KK/豆漿 抵達" }
                ]
            },
            {
                date: "12/25", day: "週四", location: "移動日",
                weather: { icon: "fa-car", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "11:46", title: "新幹線往高崎", icon: "fa-train", desc: "上野 -> 高崎" },
                    { time: "12:30", title: "高崎領車", icon: "fa-car", desc: "自駕前往白馬 (3hr)" },
                    { time: "17:00", title: "住：Keimichi", icon: "fa-home", desc: "Guest House Check-in" }
                ]
            },
            {
                date: "12/26", day: "週五", location: "白馬 Sanosaka",
                weather: { icon: "fa-snowflake", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "09:00", title: "Sanosaka 滑雪", icon: "fa-skiing", desc: "熱身日，躲人潮" },
                    { time: "22:15", title: "接機", icon: "fa-car", desc: "Angus 抵達羽田" }
                ]
            },
            {
                date: "12/27", day: "週六", location: "白馬 HopeTree",
                weather: { icon: "fa-snowflake", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "08:30", title: "全員集合", icon: "fa-users", desc: "ao lakeside cafe 接人" },
                    { time: "15:00", title: "Check-in: HopeTree", icon: "fa-suitcase", desc: "更換住宿" },
                    { time: "18:00", title: "晚餐：胡座屋", icon: "fa-utensils", desc: "關東煮" }
                ]
            },
            {
                date: "12/28", day: "週日", location: "栂池",
                weather: { icon: "fa-snowflake", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "09:00", title: "栂池 (Tsugaike)", icon: "fa-skiing", desc: "寬闊綠道，無夜滑" } ]
            },
            {
                date: "12/29", day: "週一", location: "五龍",
                weather: { icon: "fa-moon", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "10:00", title: "五龍 (Goryu)", icon: "fa-skiing", desc: "連通 Hakuba47" }, { time: "18:00", title: "夜滑", icon: "fa-snowflake", desc: "至 21:30" } ]
            },
            {
                date: "12/30", day: "週二", location: "岩岳",
                weather: { icon: "fa-camera", temp: "-", status: "Loading", rain: "" },
                details: [
                    { time: "09:00", title: "岩岳 (Iwatake)", icon: "fa-skiing", desc: "360度美景" },
                    { time: "18:00", title: "晚餐：Donmaru", icon: "fa-fish", desc: "生魚片飯" }
                ]
            },
            {
                date: "12/31", day: "週三", location: "五龍 跨年",
                weather: { icon: "fa-glass-cheers", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "All Day", title: "五龍滑雪", icon: "fa-skiing", desc: "Happy New Year!" } ]
            },
            {
                date: "1/1", day: "週四", location: "岩岳 新年",
                weather: { icon: "fa-sun", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "09:00", title: "新年首滑", icon: "fa-skiing", desc: "岩岳 Iwatake" }, { time: "12:00", title: "Yuki Burger", icon: "fa-hamburger", desc: "午餐" } ]
            },
            {
                date: "1/2", day: "週五", location: "八方",
                weather: { icon: "fa-mountain", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "09:00", title: "八方尾根", icon: "fa-skiing", desc: "挑戰奧運滑道" }, { time: "18:00", title: "Marukame", icon: "fa-fire", desc: "最後晚餐：燒肉" } ]
            },
            {
                date: "1/3", day: "週六", location: "回東京",
                weather: { icon: "fa-car", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "10:30", title: "還車", icon: "fa-car", desc: "返回東京" }, { time: "15:00", title: "入住", icon: "fa-hotel", desc: "京急EX INN 濱松町" } ]
            },
             {
                date: "1/4", day: "週日", location: "返台",
                weather: { icon: "fa-plane-departure", temp: "-", status: "Loading", rain: "" },
                details: [ { time: "09:20", title: "前往機場", icon: "fa-plane", desc: "各自搭機返台" } ]
            }
        ];

        // --- 天氣 API 核心邏輯 ---
        async function fetchWeather() {
            const today = new Date();
            const year = today.getFullYear(); // 2025
            
            // Open-Meteo API
            const urls = {
                Tokyo: `https://api.open-meteo.com/v1/forecast?latitude=${coords.Tokyo.lat}&longitude=${coords.Tokyo.long}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo`,
                Hakuba: `https://api.open-meteo.com/v1/forecast?latitude=${coords.Hakuba.lat}&longitude=${coords.Hakuba.long}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo`
            };

            try {
                const [tokyoRes, hakubaRes] = await Promise.all([
                    fetch(urls.Tokyo),
                    fetch(urls.Hakuba)
                ]);
                
                const tokyoData = await tokyoRes.json();
                const hakubaData = await hakubaRes.json();
                
                const weatherDB = {
                    Tokyo: tokyoData.daily,
                    Hakuba: hakubaData.daily
                };

                document.getElementById('weather-status').innerText = "已更新";

                tripData.forEach(day => {
                    const loc = locationMap[day.date];
                    if (!loc || !weatherDB[loc]) return;

                    // 判斷年份：如果當前是12月，行程是1月，則年份+1
                    let currentYear = year;
                    if (today.getMonth() === 11 && day.date.startsWith("1/")) {
                         currentYear = year + 1;
                    }

                    const dateStr = `${currentYear}-${day.date.split('/')[0].padStart(2, '0')}-${day.date.split('/')[1].padStart(2, '0')}`;
                    const index = weatherDB[loc].time.indexOf(dateStr);

                    if (index !== -1) {
                        const minT = Math.round(weatherDB[loc].temperature_2m_min[index]);
                        const maxT = Math.round(weatherDB[loc].temperature_2m_max[index]);
                        const rainProb = weatherDB[loc].precipitation_probability_max[index];
                        const code = weatherDB[loc].weathercode[index];

                        day.weather.temp = `${minT}°~${maxT}°`;
                        day.weather.rain = rainProb > 0 ? `<i class="fas fa-umbrella text-blue-400"></i> ${rainProb}%` : '';
                        day.weather.icon = getWeatherIcon(code);
                        day.weather.status = getWeatherDesc(code);
                    } else {
                        day.weather.temp = "N/A";
                        day.weather.status = "尚未公布";
                    }
                });

                renderApp();

            } catch (error) {
                console.error("天氣抓取失敗:", error);
                document.getElementById('weather-status').innerText = "天氣載入失敗";
                // 失敗時還是要 Render，顯示預設資料
                renderApp();
            }
        }

        function getWeatherIcon(code) {
            if (code <= 1) return "fa-sun text-orange-400";
            if (code <= 3) return "fa-cloud-sun text-gray-400";
            if (code <= 48) return "fa-smog text-gray-400";
            if (code <= 67) return "fa-cloud-rain text-blue-400";
            if (code <= 77) return "fa-snowflake text-cyan-300";
            if (code <= 82) return "fa-cloud-showers-heavy text-blue-600";
            if (code <= 86) return "fa-snowflake text-white";
            return "fa-cloud";
        }
        
        function getWeatherDesc(code) {
            if (code <= 1) return "晴朗";
            if (code <= 3) return "多雲";
            if (code <= 67) return "有雨";
            if (code <= 77) return "降雪";
            if (code <= 86) return "大雪";
            return "陰天";
        }

        // --- RENDER FUNCTION ---
        function renderApp() {
            const weatherContainer = document.getElementById('weather-container');
            const tabsContainer = document.getElementById('date-tabs');
            const contentContainer = document.getElementById('itinerary-content');

            // 保持當前選中的 Tab
            let currentActiveIndex = 0;
            const activeTab = document.querySelector('.tab-active');
            if (activeTab) {
                 const tabs = Array.from(document.getElementById('date-tabs').children);
                 currentActiveIndex = tabs.indexOf(activeTab);
            }
            if (currentActiveIndex === -1) currentActiveIndex = 0;

            weatherContainer.innerHTML = '';
            tabsContainer.innerHTML = '';
            contentContainer.innerHTML = '';

            tripData.forEach((day, index) => {
                // 1. 天氣卡
                const isSnow = day.weather.icon.includes('snowflake');
                const cardBg = isSnow ? 'bg-blue-50 border-blue-200' : 'bg-white border-slate-100';
                
                const weatherCard = `
                    <div class="snap-start shrink-0 w-28 ${cardBg} rounded-xl p-3 flex flex-col items-center justify-center border shadow-sm">
                        <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-1">${day.date} ${day.location}</span>
                        <i class="fas ${day.weather.icon} text-2xl mb-1 mt-1 drop-shadow-sm"></i>
                        <span class="font-bold text-slate-700 text-sm my-1">${day.weather.temp}</span>
                        <span class="text-[10px] text-gray-500">${day.weather.status} ${day.weather.rain}</span>
                    </div>
                `;
                weatherContainer.innerHTML += weatherCard;

                // 2. Tabs
                const tabBtn = document.createElement('button');
                const isActive = index === currentActiveIndex;
                tabBtn.className = `snap-start shrink-0 px-5 py-2 rounded-full text-sm font-medium transition-all duration-200 border border-slate-200 whitespace-nowrap ${isActive ? 'tab-active' : 'bg-white text-slate-500 hover:bg-slate-50'}`;
                tabBtn.innerHTML = `${day.date} <span class="text-xs opacity-70 ml-1">${day.day}</span>`;
                tabBtn.onclick = () => switchTab(index);
                tabsContainer.appendChild(tabBtn);

                // 3. 內容
                const dayContent = document.createElement('div');
                dayContent.id = `day-${index}`;
                dayContent.className = `space-y-4 ${isActive ? 'block' : 'hidden'} animate-fade-in`;
                
                let contentHTML = `
                    <div class="flex items-center justify-between mb-4 mt-2">
                        <h2 class="text-2xl font-bold text-slate-800 tracking-tight">${day.location}</h2>
                        <div class="text-right">
                             <span class="block text-xl font-bold text-primary">${day.weather.temp}</span>
                        </div>
                    </div>
                `;

                day.details.forEach(item => {
                    contentHTML += `
                        <div class="flex gap-4 relative pb-8 last:pb-2 group">
                            <div class="absolute left-[19px] top-8 bottom-0 w-0.5 bg-slate-200 last:hidden"></div>
                            <div class="relative shrink-0 w-10 h-10 rounded-full bg-white border-2 border-slate-100 flex items-center justify-center text-primary shadow-sm z-10 group-hover:border-primary group-hover:scale-110 transition-all">
                                <i class="fas ${item.icon}"></i>
                            </div>
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-50 flex-1 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="font-bold text-slate-800 text-base">${item.title}</h3>
                                    <span class="text-xs font-mono text-slate-400 bg-slate-50 px-2 py-1 rounded-md border border-slate-100">${item.time}</span>
                                </div>
                                <p class="text-sm text-gray-600 leading-relaxed">${item.desc}</p>
                                ${item.link ? `<a href="${item.link}" target="_blank" class="inline-flex items-center mt-3 text-xs text-white bg-primary px-3 py-1.5 rounded-lg hover:bg-blue-600 transition-colors shadow-sm"><i class="fas fa-location-arrow mr-1"></i> 導航</a>` : ''}
                            </div>
                        </div>
                    `;
                });
                dayContent.innerHTML = contentHTML;
                contentContainer.appendChild(dayContent);
            });
        }

        // --- 切換分頁 ---
        function switchTab(selectedIndex) {
            const tabs = document.getElementById('date-tabs').children;
            const contents = document.getElementById('itinerary-content').children;
            
            for (let i = 0; i < tabs.length; i++) {
                if (i === selectedIndex) {
                    tabs[i].classList.add('tab-active');
                    tabs[i].classList.remove('bg-white', 'text-slate-500', 'hover:bg-slate-50');
                    tabs[i].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    contents[i].classList.remove('hidden');
                } else {
                    tabs[i].classList.remove('tab-active');
                    tabs[i].classList.add('bg-white', 'text-slate-500', 'hover:bg-slate-50');
                    contents[i].classList.add('hidden');
                }
            }
        }

        function showResortInfo() {
            document.getElementById('resort-modal').classList.remove('hidden');
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderApp(); // 先畫框
            fetchWeather(); // 再抓天氣
            
            // 倒數計時器
            const targetDate = new Date("December 21, 2025 16:50:00").getTime();
            setInterval(() => {
                const now = new Date().getTime();
                const dist = targetDate - now;
                const days = Math.floor(dist / (1000 * 60 * 60 * 24));
                const hours = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById("countdown").innerText = `倒數 ${days} 天 ${hours} 時`;
            }, 1000);
        });
    </script>
</body>
</html>
